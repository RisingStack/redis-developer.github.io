---
id: index-basic-redis-chat-app-in-nodejs
title: Basic Redis chat app in Nodejs
sidebar_label: Basic Redis chat app in Nodejs
slug: /marketplace/basic-redis-chat-app-in-nodejs
---

# Basic Redis Chat App Demo

A basic chat application built with Express.js Socket.io and Redis.

## Try it out

#### Deploy to Heroku

&lt;p&gt;
    &lt;a href&#x3D;&quot;https://heroku.com/deploy&quot; target&#x3D;&quot;_blank&quot;&gt;
        &lt;img src&#x3D;&quot;https://www.herokucdn.com/deploy/button.svg&quot; alt&#x3D;&quot;Deploy to Heorku&quot; /&gt;
    &lt;/a&gt;
&lt;/p&gt;

#### Deploy to Google Cloud

&lt;p&gt;
    &lt;a href&#x3D;&quot;https://deploy.cloud.run&quot; target&#x3D;&quot;_blank&quot;&gt;
        &lt;img src&#x3D;&quot;https://deploy.cloud.run/button.svg&quot; alt&#x3D;&quot;Run on Google Cloud&quot; width&#x3D;&quot;150px&quot;/&gt;
    &lt;/a&gt;
&lt;/p&gt;

## How it works?

![How it works](docs/screenshot001.png)

### How the data is stored:

Redis is used mainly as a database to keep the user/messages data and for sending messages between connected servers.  
The session is stored separately in Redis with a use of &#x60;connect-redis&#x60; **library** on successful log in.

The real-time functionality is handled by **Socket.IO** for server-client messaging. Additionally each server instance subscribes to the &#x60;MESSAGES&#x60; channel of pub/sub and dispatches messages once they arrive.

- The chat data is stored in various keys and various data types.
  - User data is stored in a hash set where each user entry contains the next values:
    - &#x60;username&#x60;: unique user name;
    - &#x60;password&#x60;: hashed password
  - Additionally a set of rooms is associated with user
  - **Rooms** are sorted sets which contains messages where score is the timestamp for each message
    - Each room has a name associated with it
  - **Online** set is global for all users is used for keeping track on which user is online.

**User** hash set is accessed by key &#x60;user:{userId}&#x60;. The data for it stored with &#x60;HSET key field data&#x60;. User id is calculated by incrementing the &#x60;total_users&#x60; key (&#x60;INCR total_users&#x60;)

**Username** is stored as a separate key (&#x60;username:{username}&#x60;) which returns the userId for quicker access and stored with &#x60;SET username:{username} {userId}&#x60;.

**Rooms** which user belongs too are stored at &#x60;user:{userId}:rooms&#x60; as a set of room ids. A room is added by &#x60;SADD user:{userId}:rooms {roomId}&#x60; command.

**Messages** are stored at &#x60;room:{roomId}&#x60; key in a sorted set (as mentioned above). They are added with &#x60;ZADD room:{roomId} {timestamp} {message}&#x60; command. Message is serialized to an app-specific JSON string.

### How the data is accessed:

- Get User &#x60;HGETALL user:{id}&#x60;
- Online users: &#x60;SMEMBERS online_users&#x60;. This will return ids of users which are online
- Get room ids of a user: &#x60;SMEMBERS user:{id}:rooms&#x60;
- Get list of messages &#x60;ZREVRANGE room:{roomId} {offset_start} {offset_end}&#x60;

## How to run it locally?

#### Copy &#x60;.env.sample&#x60; to create &#x60;.env&#x60;. And provide the values for environment variables

    - REDIS_ENDPOINT_URI: Redis server URI
    - REDIS_PASSWORD: Password to the server

#### Run frontend

&#x60;&#x60;&#x60;sh
cd client
yarn install
yarn start
&#x60;&#x60;&#x60;

#### Run backend

&#x60;&#x60;&#x60;sh
yarn install
yarn start
&#x60;&#x60;&#x60;

